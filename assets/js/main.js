
const translations = {
    en: {
        nav_home: "Home",
        nav_menu: "Menu",
        nav_story: "Our Story",
        nav_reservations: "Reservations",
        nav_location: "Location",
        nav_contact: "Contact",
        book_table: "Book a Table",
        book_now: "Book Now",
        hero_title: "Authentic Charcoal Flavor",
        hero_subtitle: "Experience the taste of Cairo in every bite. Traditional Egyptian Kabab & Kofta grilled to perfection over open charcoal fire.",
        view_menu: "View Menu",
        featured: "Featured",
        mixed_grill: "Mixed Grill Platter",
        hawawshi: "Traditional Hawawshi",
        koshary: "Royal Koshary",
        order_now: "Order Now",
        signature_dishes: "Signature Dishes",
        from_grill: "From the Grill",
        view_full_menu: "View Full Menu",
        menu_sections: "Menu Sections",
        traditional_sides: "Traditional Sides",
        mahshi_tagines: "Mahshi & Tagines",
        desserts: "Desserts",
        beverages: "Beverages",
        order_online: "Order Online",
        jump_to_category: "Jump to category",
        get_in_touch: "Get in Touch",
        contact_desc: "We'd love to hear from you. Fill out the form below or reach out to us directly.",
        send_message: "Send us a Message",
        full_name: "Full Name",
        email_address: "Email Address",
        message: "Message",
        submit_message: "Send Message",
        contact_info: "Contact Information",
        reserve_table_title: "Reserve Your Table",
        reservation_desc: "Experience authentic Egyptian flavors in a warm, rustic atmosphere. Please fill out the form below to secure your spot.",
        date_label: "Date",
        time_label: "Time",
        guests_label: "Number of Guests",
        special_requests: "Special Requests (Optional)",
        book_table_submit: "Book a Table",
        phone_number: "Phone Number",
        footer_explore: "Explore",
        footer_visit: "Visit Us",
        footer_hours: "Opening Hours",
        catering: "Catering",
        gift_cards: "Gift Cards",
        privacy_policy: "Privacy Policy",
        terms_of_service: "Terms of Service",
        rights_reserved: "All rights reserved.",
        address_line1: "123 Nile Avenue",
        address_line2: "Downtown, Cairo Block",
        mon_thu: "Mon - Thu",
        fri_sat: "Fri - Sat",
        sunday: "Sunday",
        visit_title: "Visit Abu Khaled",
        visit_subtitle: "Authentic charcoal grilled flavors.",
        address_label: "Address",
        contact_label: "Contact",
        daily: "Daily",
        bamya: "Bamya (Okra) Tagine",
        wara_enab: "Wara' Enab (Vine Leaves)",
        om_ali: "Om Ali",
        basbousa: "Basbousa",
        mombar: "Mombar",
        egyptian_rice: "Egyptian Rice",
        shish_tawook: "Shish Tawook",
        kofta_kebab: "Kofta Kebab",
        mombar_desc: "Rice-stuffed beef sausage casing, boiled with herbs and fried golden brown.",
        hawawshi_desc: "Crispy baladi bread stuffed with spiced minced meat, onions, and peppers.",
        rice_desc: "Classic white rice cooked with vermicelli noodles and butter.",
        bamya_desc: "Tender okra cooked in a rich tomato sauce with garlic, coriander, and chunks of beef, slow-cooked in a clay pot.",
        wara_enab_desc: "Grape leaves rolled and stuffed with a savory mix of rice, herbs, and spices, simmered in lemon broth.",
        om_ali_desc: "Egypt's national dessert. Flaky puff pastry soaked in hot milk, cream, and nuts, baked until golden.",
        basbousa_desc: "Sweet semolina cake soaked in simple syrup, topped with almonds.",
        mixed_grill_desc: "A hearty selection of shish tawook, kofta, and lamb chops served with saffron rice and tahini.",
        shish_tawook_desc: "Marinated chicken skewers grilled to perfection, seasoned with garlic, yogurt, and Egyptian spices.",
        kofta_kebab_desc: "Minced beef and lamb spiced with parsley, onions, and our secret spice blend, grilled on skewers.",
        koshary_desc: "Egypt's national dish. A mix of rice, lentils, and pasta topped with spicy tomato sauce and garlic vinegar.",
        story_p1: "Founded on family recipes passed down through three generations, Abu Khaled brings the bustling street food culture of Cairo to your table.",
        story_p2: "We believe authentic flavor starts with the fire. That's why every skewer of Kabab and Kofta is grilled over natural wood charcoal, marinated with our signature 12-spice blend imported directly from the spice markets of Khan el-Khalili.",
        years_exp: "Years Experience",
        secret_spices: "Secret Spices",
        halal_cert: "Halal Certified",
        review_text: "\"The Kofta is exactly how I remember it from my childhood in Alexandria. Smoky, juicy, and perfectly spiced. A hidden gem.\"",
        review_author: "Ahmed Hassan",
        chefs_special: "Chef's Special Mixed Grill",
        food_quote: "\"Food is the ingredient that binds us together.\"",
        authentic_atmos: "Authentic Atmosphere",
        rustic_charm: "Experience the rustic charm of old Cairo.",
        view_gallery: "View Gallery",
        add_to_order: "Add to Order",
        add: "Add"
    },
    ar: {
        nav_home: "الرئيسية",
        nav_menu: "القائمة",
        nav_story: "قصتنا",
        nav_reservations: "حجز",
        nav_location: "الموقع",
        nav_contact: "تواصل معنا",
        book_table: "احجز طاولة",
        book_now: "احجز الآن",
        hero_title: "نكهة الشواء الأصيلة",
        hero_subtitle: "جرب طعم القاهرة في كل قضمة. كباب وكفتة مصرية تقليدية مشوية ببراعة على الفحم الطبيعي.",
        view_menu: "شاهد القائمة",
        featured: "متميز",
        mixed_grill: "صحن مشاوي مشكل",
        hawawshi: "حواوشي تقليدي",
        koshary: "كشري ملكي",
        order_now: "اطلب الآن",
        signature_dishes: "أطباق مميزة",
        from_grill: "من الشواية",
        view_full_menu: "شاهد القائمة الكاملة",
        menu_sections: "أقسام القائمة",
        traditional_sides: "أطباق جانبية تقليدية",
        mahshi_tagines: "محاشي وطواجن",
        desserts: "حلويات",
        beverages: "مشروبات",
        order_online: "اطلب أونلاين",
        jump_to_category: "انتقل للقسم",
        get_in_touch: "تواصل معنا",
        contact_desc: "نود أن نسمع منك. املأ النموذج أدناه أو تواصل معنا مباشرة.",
        send_message: "أرسل لنا رسالة",
        full_name: "الاسم الكامل",
        email_address: "البريد الإلكتروني",
        message: "الرسالة",
        submit_message: "إرسال الرسالة",
        contact_info: "معلومات التواصل",
        reserve_table_title: "احجز طاولتك",
        reservation_desc: "جرب النكهات المصرية الأصيلة في جو دافئ. يرجى ملء النموذج أدناه لتأكيد حجزك.",
        date_label: "التاريخ",
        time_label: "الوقت",
        guests_label: "عدد الضيوف",
        special_requests: "طلبات خاصة (اختياري)",
        book_table_submit: "تأكيد الحجز",
        phone_number: "رقم الهاتف",
        footer_explore: "استكشف",
        footer_visit: "زورونا",
        footer_hours: "ساعات العمل",
        catering: "خدمات الضيافة",
        gift_cards: "بطاقات الهدايا",
        privacy_policy: "سياسة الخصوصية",
        terms_of_service: "شروط الخدمة",
        rights_reserved: "جميع الحقوق محفوظة.",
        address_line1: "١٢٣ شارع النيل",
        address_line2: "وسط البلد، القاهرة",
        mon_thu: "الاثنين - الخميس",
        fri_sat: "الجمعة - السبت",
        sunday: "الأحد",
        visit_title: "زوروا أبو خالد",
        visit_subtitle: "نكهات شواء أصلية على الفحم.",
        address_label: "العنوان",
        contact_label: "اتصل بنا",
        daily: "يومياً",
        bamya: "طاجن بامية",
        wara_enab: "ورق عنب",
        om_ali: "أم علي",
        basbousa: "بسبوسة",
        mombar: "ممبار",
        egyptian_rice: "أرز مصري",
        shish_tawook: "شيش طاووق",
        kofta_kebab: "كفتة كباب",
        mombar_desc: "أمعاء بقرية محشوة بالأرز والأعشاب، مسلوقة ومقلية حتى تصبح ذهبية اللون.",
        hawawshi_desc: "خبز بلدي مقرمش محشو باللحم المفروم المتبل والبصل والفلفل.",
        rice_desc: "أرز أبيض كلاسيكي مطبوخ مع الشعيرية والزبدة.",
        bamya_desc: "بامية طرية مطبوخة في صلصة طماطم غنية مع الثوم والكزبرة وقطع اللحم، مطهية ببطء في وعاء فخاري.",
        wara_enab_desc: "ورق عنب ملفوف ومحشو بخلطة لذيذة من الأرز والأعشاب والتوابل، مطهي في مرق الليمون.",
        om_ali_desc: "الحلوى الوطنية لمصر. رقائق عجين منقوعة في الحليب الساخن والقشطة والمكسرات، مخبوزة حتى تصبح ذهبية.",
        basbousa_desc: "كيكة سميد حلوة مسقية بالقطر البسيط، مزينة باللوز.",
        mixed_grill_desc: "تشكيلة غنية من الشيش طاووق والكفتة وريش الضأن تقدم مع أرز بالزعفران وطحينة.",
        shish_tawook_desc: "أسياخ دجاج متبلة ومشوية ببراعة، متبلة بالثوم والزبادي والبهارات المصرية.",
        kofta_kebab_desc: "لحم بقري وضأن مفروم متبل بالبقدونس والبصل وخلطة بهاراتنا السرية، مشوي على الأسياخ.",
        koshary_desc: "طبق مصر الوطني. مزيج من الأرز والعدس والمكرونة مغطى بصلصة الطماطم الحارة والخل بالثوم.",
        story_p1: "تأسس مطعم أبو خالد بناءً على وصفات عائلية متوارثة عبر ثلاثة أجيال، ليجلب ثقافة طعام الشارع الصاخبة في القاهرة إلى طاولتك.",
        story_p2: "نؤمن بأن النكهة الأصيلة تبدأ من النار. ولهذا السبب، يتم شواء كل سيخ من الكباب والكفتة على الفحم الطبيعي، ومتبل بخلطة البهارات الـ ١٢ الخاصة بنا والمستوردة مباشرة من أسواق التوابل في خان الخليلي.",
        years_exp: "سنوات من الخبرة",
        secret_spices: "توابل سرية",
        halal_cert: "حلال ١٠٠٪",
        review_text: "\"الكفتة طعمها زي ما بفتكره من طفولتي في إسكندرية بالظبط. مدخنة، طرية، ومتبلة صح. جوهرة مخفية.\"",
        review_author: "أحمد حسن",
        chefs_special: "مشويات الشيف الخاصة",
        food_quote: "\"الطعام هو المكون الذي يجمعنا معاً.\"",
        authentic_atmos: "أجواء أصيلة",
        rustic_charm: "جرب السحر الريفي للقاهرة القديمة.",
        view_gallery: "شاهد المعرض",
        add_to_order: "أضف للطلب",
        add: "أضف"
    }
};

document.addEventListener('DOMContentLoaded', () => {
    initMobileMenu();
    initReservationForm();
    initGuestSelector();
    initAddToOrder();
    initTheme();
    initLanguage();
});

function initTheme() {
    const themeToggle = document.getElementById('theme-toggle');
    const html = document.documentElement;
    const icon = themeToggle ? themeToggle.querySelector('.material-symbols-outlined') : null;

    // Check saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
        html.classList.add('dark');
        if(icon) icon.textContent = 'light_mode';
    } else {
        html.classList.remove('dark');
        if(icon) icon.textContent = 'dark_mode';
    }

    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const isDark = html.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            if(icon) icon.textContent = isDark ? 'light_mode' : 'dark_mode';
        });
    }
}

function initLanguage() {
    const langToggle = document.getElementById('lang-toggle');
    const savedLang = localStorage.getItem('lang') || 'en';

    // Apply initial language
    updateLanguage(savedLang);

    if (langToggle) {
        langToggle.addEventListener('click', () => {
            const currentLang = document.documentElement.lang || 'en';
            const newLang = currentLang === 'en' ? 'ar' : 'en';
            updateLanguage(newLang);
        });
    }
}

function updateLanguage(lang) {
    const html = document.documentElement;
    const langToggle = document.getElementById('lang-toggle');

    html.lang = lang;
    html.dir = lang === 'ar' ? 'rtl' : 'ltr';
    localStorage.setItem('lang', lang);

    if (langToggle) {
        langToggle.textContent = lang === 'en' ? 'عربي' : 'English';
        langToggle.style.fontFamily = lang === 'en' ? "'Noto Sans', sans-serif" : "'Be Vietnam Pro', sans-serif";
    }

    if (lang === 'ar') {
        document.body.style.fontFamily = "'Noto Sans', sans-serif";
    } else {
        document.body.style.fontFamily = "'Be Vietnam Pro', sans-serif";
    }

    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
             // Handle simple text replacement for now, robust enough for this scope
             // Check if element has only text nodes to be safe, or just overwrite.
             // For buttons with icons, we might lose the icon if we use textContent.
             // We need to preserve children.

             if (element.children.length === 0) {
                 element.textContent = translations[lang][key];
             } else {
                 // For elements with children (like buttons with icons), try to find a child text node or specific span?
                 // Most buttons in my HTML have text inside a span with data-i18n, so this else branch might not even be hit for them.
                 // E.g. <span data-i18n="book_table">Book</span>. This span has no children.

                 // If the element ITSELF has data-i18n and children, we have a problem.
                 // Let's inspect my usage.
                 // index.html: <a data-i18n="nav_menu">Menu</a> (no children)
                 // <span data-i18n="book_table"> (no children)
                 // <h1 data-i18n="hero_title"> (no children usually)

                 // The only complex one might be if I add data-i18n to a container.
                 // I will stick to adding data-i18n to leaf nodes containing text.

                 // However, "View Menu" button in hero:
                 // <button> <span data-i18n="view_menu">View Menu</span> <span icon>...</span> </button>
                 // I should ensure I add data-i18n to the span, not the button.

                 // So, safe to just use textContent if I follow that rule.
                  element.textContent = translations[lang][key];
             }
        }
    });
}

function initMobileMenu() {
    const openBtn = document.getElementById('open-menu-btn');
    const closeBtn = document.getElementById('close-menu-btn');
    const menu = document.getElementById('mobile-menu');

    if (openBtn && menu) {
        openBtn.addEventListener('click', () => {
            menu.classList.remove('translate-x-full');
            menu.classList.remove('rtl:translate-x-full');
        });
    }

    if (closeBtn && menu) {
        closeBtn.addEventListener('click', () => {
            menu.classList.add('translate-x-full');
        });
    }

    if (menu) {
        const links = menu.querySelectorAll('a');
        links.forEach(link => {
            link.addEventListener('click', () => {
                menu.classList.add('translate-x-full');
            });
        });
    }
}

function initReservationForm() {
    const form = document.getElementById('reservation-form');
    if (!form) return;

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const submitBtn = form.querySelector('button[type="submit"]') || form.querySelector('button:last-of-type');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = document.documentElement.lang === 'ar' ? 'جاري الحجز...' : 'Booking...';
        submitBtn.disabled = true;

        setTimeout(() => {
            const successMsg = document.documentElement.lang === 'ar' ? 'تم الحجز بنجاح! نتطلع لرؤيتكم.' : 'Reservation successful! We look forward to seeing you.';
            alert(successMsg);
            form.reset();
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;

        }, 1500);
    });
}

function initGuestSelector() {
    const guestBtns = document.querySelectorAll('.guest-btn');
    if (guestBtns.length === 0) return;

    guestBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            guestBtns.forEach(b => {
                b.classList.remove('bg-primary', 'border-primary', 'text-black', 'font-bold', 'shadow-lg');
                b.classList.add('bg-white', 'dark:bg-[#221f10]', 'text-[#181711]', 'dark:text-white', 'font-medium');
            });

            btn.classList.remove('bg-white', 'dark:bg-[#221f10]', 'text-[#181711]', 'dark:text-white', 'font-medium');
            btn.classList.add('bg-primary', 'border-primary', 'text-black', 'font-bold', 'shadow-lg');
        });
    });
}

function initAddToOrder() {
    const buttons = document.querySelectorAll('.add-to-order-btn');

    buttons.forEach(btn => {
        btn.addEventListener('click', function() {
            const originalText = this.innerText;
            this.innerText = document.documentElement.lang === 'ar' ? 'تم!' : 'Added!';
            this.classList.add('bg-green-500', 'text-white');

            const toastMsg = document.documentElement.lang === 'ar' ? 'تمت الإضافة للطلب' : 'Item added to your order';
            showToast(toastMsg);

            setTimeout(() => {
                this.innerText = originalText;
                this.classList.remove('bg-green-500', 'text-white');
            }, 2000);
        });
    });
}

function showToast(message) {
    let container = document.getElementById('toast-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'toast-container';
        container.className = 'fixed bottom-4 z-50 flex flex-col gap-2';
        if (document.documentElement.dir === 'rtl') {
            container.style.left = '1rem';
        } else {
            container.style.right = '1rem';
        }

        document.body.appendChild(container);
    } else {
         if (document.documentElement.dir === 'rtl') {
            container.style.left = '1rem';
            container.style.right = 'auto';
        } else {
            container.style.right = '1rem';
            container.style.left = 'auto';
        }
    }

    const toast = document.createElement('div');
    toast.className = 'bg-deep-brown dark:bg-white text-white dark:text-deep-brown px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-y-10 opacity-0 flex items-center gap-2';
    toast.innerHTML = `<span class="material-symbols-outlined text-primary">check_circle</span> ${message}`;

    container.appendChild(toast);

    requestAnimationFrame(() => {
        toast.classList.remove('translate-y-10', 'opacity-0');
    });

    setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-10');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}
